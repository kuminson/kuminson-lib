!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.utils=e():t.utils=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t){return t.replace(/^data-/,"").replace(/-(\w)/g,(t,e)=>e.toUpperCase())}n.r(e);const r=["text","password","number","email","url","textarea"],o=i("data-validate"),s=i("data-validate-value");class l{constructor(t,e){const n=document.querySelector(t).querySelectorAll("[data-validate]"),i=r,s=["INPUT","TEXTAREA"];this.config=e,this.inputEls={};for(let t of n)-1!==s.indexOf(t.nodeName)&&t.type&&-1!==i.indexOf(t.type)&&(this.inputEls[t.dataset[o]]=t);this.inputFilterFunc={};for(let t in this.config)this.inputFilterFunc[t]=e=>{let n=e.target.value;for(let e of this.config[t])n=e(n);e.target.value=n}}add(){for(let t in this.config)this.inputEls[t].addEventListener("input",this.inputFilterFunc[t],!1)}remove(){for(let t in this.config)this.inputEls[t].removeEventListener("input",this.inputFilterFunc[t],!1)}}l.filter={onlyNumber(t){let e;return e=0===t?new RegExp(/^\d+/):-1===t?new RegExp("^\\d+\\.?(?:\\d)*"):new RegExp("^\\d+\\.?(?:\\d{0,"+t+"})?"),t=>{const n=t.match(e);let i="";return null!==n&&(i=n[0]),i}},noZeroBefore:()=>t=>t.replace(/^0+([1-9][0-9]*(?:\.|\.[0-9]+)?)$/,"$1"),max:t=>e=>{let n=e;return Number(e)>t&&(n=String(t)),n},min:t=>e=>{let n=e;return Number(e)<t&&(n=String(t)),n}};var a={FireCounter:class{constructor(t,e,n){this.newNum(t),this.nowNum=0,this.fireFun=e,this.id=void 0!==n?n:null}fire(t){(null!==this.id&&this.id===t||null===this.id)&&(this.nowNum+=1,this.nowNum>=this.totalNum&&this.fireFun())}reset(){this.nowNum=0}newNum(t){t.toString()>=0?this.totalNum=t.toString():this.totalNum=0,this.reset()}},NoScrollPuncture:class{constructor(t){this.dom=document.querySelector(t),this.posY=0,this.maxScroll=0,this._addEvent()}_touchStart(t){const e=t.touches[0]||t;this.posY=e.pageY,this.maxScroll=this.dom.scrollHeight-this.dom.clientHeight}_touchMove(t){this.maxScroll<=0&&t.preventDefault();const e=this.dom.scrollTop,n=(t.touches[0]||t).pageY-this.posY;(n>0&&0===e&&t.cancelable||n<0&&e+1>=this.maxScroll&&t.cancelable)&&t.preventDefault()}_addEvent(){this.startEvent=t=>{this._touchStart(t)},this.endEvent=t=>{this._touchMove(t)},this.dom.addEventListener("touchstart",this.startEvent),this.dom.addEventListener("touchmove",this.endEvent)}removeEvent(){this.dom.removeEventListener("touchstart",this.startEvent),this.dom.removeEventListener("touchmove",this.endEvent)}},InputFilter:l,AutoFillForm:class{constructor(t){this.itemType={textType:["text","password","number","email","url","textarea"],checkType:["checkbox","radio"]},this._testValTextFunc={required:()=>"",text:t=>t.text,max(t){const e=Math.ceil(t.max/t.text.length)+1;let n="";for(let i=0;i<e;i++)n+=t.text;return n},space(t){let e=t.text;switch(t.space){case"before":e=" "+e;break;case"after":e+=" ";break;case"all":e=" "+e+" "}return e}},this._testValSelectFunc={required:()=>[]},this.testConfig=t.testConfig,this.validator=t.validator,this.inputEls=this._getInputEls(t.formSelector)}_getInputEls(t){const e=document.querySelector(t).querySelectorAll("[data-validate]"),n={};for(let t of e)t.type&&-1!==this.itemType.textType.indexOf(t.type)&&(n[t.dataset.validate]=t),t.type&&-1!==this.itemType.checkType.indexOf(t.type)&&(void 0===n[t.dataset.validate]&&(n[t.dataset.validate]=[]),n[t.dataset.validate].push(t));return n}test(){return this._fillTest(!0)}fill(){return this._fillTest(!1)}async _fillTest(t){let e=!0;for(let n of this.testConfig)if(void 0!==this.inputEls[n.key]){if(void 0!==n.test&&t)for(let t of n.test){if(!await new Promise(e=>{void 0===this.inputEls[n.key].length?this.inputEls[n.key].focus():this.inputEls[n.key][0].focus();let i=null;void 0===this.inputEls[n.key].length?(i=this._testValTextFunc[t.type](t),this._setValText(this.inputEls[n.key],i)):(i=this._testValSelectFunc[t.type](t),this._setValSelect(this.inputEls[n.key],i)),setTimeout(()=>{const t=getInputValue(".form",(t,e,n)=>"input"===n&&"string"==typeof t?t.trim():t);this.validator.validate(t).then(()=>{console.log("效检");const r=this._isSameVal(this.inputEls[n.key],i,t[n.key]);e(!r)}).catch(({errors:r})=>{console.log("效检",r);for(let t of r)t.field===n.key&&e(!0);this._isSameVal(this.inputEls[n.key],i,t[n.key])||e(!0),e(!1)})},20)})){console.log("边缘测试未通过",t),e=!1;break}}void 0===this.inputEls[n.key].length?this._setValText(this.inputEls[n.key],n.safe):this._setValSelect(this.inputEls[n.key],n.safe)}return!!e&&(console.log("边缘测试 通过"),!0)}_setValText(t,e){const n=new InputEvent("input",{inputType:"insertText",data:e,dataTransfer:null,isComposing:!1});t.value=e,t.dispatchEvent(n)}_setValSelect(t,e){for(let n of t)-1!==e.indexOf(n.value)&&(n.checked=!0)}_isSameVal(t,e,n){let i=null;return i=void 0===t.length?e===n:JSON.stringify(JSON.parse(JSON.stringify(e)).sort())===JSON.stringify(JSON.parse(JSON.stringify(n)).sort()),i}}},u={getOs(){let t=navigator.userAgent||navigator.vendor||window.opener;return/ipad|iphone|ipod/i.test(t)?"ios":/android/i.test(t)?"android":"desktop"},getUuid(t,e){let n,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=[];if(e=e||i.length,t)for(n=0;n<t;n++)r[n]=i[0|Math.random()*e];else{let t;for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",n=0;n<36;n++)r[n]||(t=0|16*Math.random(),r[n]=i[19===n?3&t|8:t])}return r.join("")},midtextEllipsis(t,e){const n=window.document.querySelector("#"+t),i=document.createElement("div");i.style.whiteSpace="nowrap",i.style.opacity=0;let r=e.slice(0,Math.floor(e.length/2)),o=e.slice(Math.floor(e.length/2));if(i.innerText=r+o,n.appendChild(i),i.scrollWidth<n.offsetWidth)return e;for(i.innerText=r+"..."+o;i.scrollWidth-n.offsetWidth>2;)r.length>o.length?r=r.slice(0,-1):o=o.slice(1),i.innerText=r+"..."+o;return n.removeChild(i),r+"..."+o},parseUrlParams(){let t,e={},n=decodeURI(location.search).replace(/^\?/,"").split("&"),i=n.length;for(let r=0;r<i;r++)n[r]&&(t=n[r].split("="),e[t[0]]=t[1]);return e},encodeUrlParam(t){let e="";for(let n in t)""!==t[n]&&void 0!==t[n]&&(e+="&"+n+"="+t[n]);return""===e?"":(e=e.replace(/^&/,"?"),encodeURI(e))},numAddThousandSeparator:t=>String(t).replace(/\d+/,(function(t){return t.replace(/(\d)(?=(\d{3})+$)/g,"$1,")})),parseLastTime(t){let e=Number(t),n="";const i=[];if(e<1e3)return"";const r=[{key:"d",num:864e5},{key:"h",num:36e5},{key:"m",num:6e4}];for(let t=0;t<r.length;t++)e/r[t].num>=1?(i.push(Math.floor(e/r[t].num)),e-=Math.floor(e/r[t].num)*r[t].num):i.push(0);i.push(Math.floor(Number(.001*e)%60));const o=i.findIndex(t=>t>0);let s=JSON.parse(JSON.stringify(i)).reverse().findIndex(t=>t>0);s=i.length-1-s;const l=["day","h","m","s"];for(let t=o;t<=s;t++)n=0===t&&i[t]>1?n+" "+i[t]+"days":n+" "+i[t]+l[t];return this.addTrimFunc(),n.trim()},addTrimFunc(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")})},safariReload(){/^.*((iPhone)|(iPad)|(Safari))+.*$/.test(navigator.userAgent)&&(window.onpageshow=function(t){(t.persisted||window.performance&&2===window.performance.navigation.type)&&window.location.reload()})},extensionArrayRemove(t,e,n){let i=t.slice((n||e)+1||t.length);return t.length=e<0?t.length+e:e,t.push.apply(t,i),t},getStringBytes(t,e){let n,i,r,o=0;if("utf-16"===(e=e?e.toLowerCase():"")||"utf16"===e)for(i=0,r=t.length;i<r;i++)n=t.charCodeAt(i),o+=n<=65535?2:4;else for(i=0,r=t.length;i<r;i++)n=t.charCodeAt(i),o+=n<=127?1:n<=2047?2:n<=65535?3:4;return o},getUserAgentLanguage(){let t=window.navigator.userAgent.match(/language=(.+?)(?:\/|$)/);return null!=t?decodeURI(t[1]):null},getInputValue(t,e){const n=document.querySelector(t).querySelectorAll("[data-validate]"),i={},l=r,a=["checkbox","radio"];for(let t of n)if(t.type&&-1!==l.indexOf(t.type)){let n=t.value;if("function"==typeof e){const i=e(n,t.dataset[o],"input");n=void 0===i?n:i}i[t.dataset[o]]=n}else if(t.type&&-1!==a.indexOf(t.type)){let n=t.value;if("function"==typeof e){const i=e(n,t.dataset[o],"select");n=void 0===i?n:i}void 0===i[t.dataset[o]]&&(i[t.dataset[o]]=[]),t.checked&&i[t.dataset[o]].push(n)}else if(void 0!==t.dataset[s]){let n=t.dataset[s];if("function"==typeof e){const i=e(n,t.dataset[o],"other");n=void 0===i?n:i}i[t.dataset[o]]=n}return i}};e.default={...a,...u}}])}));
//# sourceMappingURL=utils.js.map